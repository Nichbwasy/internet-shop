databaseChangeLog:
  - changeSet:
      id: create-authorities-table
      author: Nichbwasy
      changes:
        - createTable:
            schemaName: authorization
            tableName: authority
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                      unique: 'true'
                      nullable: 'false'
              - column:
                  name: name
                  type: varchar(64)
                  constraints:
                    unique: 'true'
                    nullable: 'false'

  - changeSet:
      id: create-roles-table
      author: Nichbwasy
      changes:
        - createTable:
            schemaName: authorization
            tableName: role
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    unique: 'true'
                    nullable: 'false'
              - column:
                  name: name
                  type: varchar(64)
                  constraints:
                    unique: 'true'
                    nullable: 'false'

  - changeSet:
      id: create-user-data-table
      author: Nichbwasy
      changes:
        - createTable:
            schemaName: authorization
            tableName: user_data
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    unique: 'true'
                    nullable: 'false'
              - column:
                  name: login
                  type: varchar(64)
                  constraints:
                    unique: 'true'
                    nullable: 'false'
              - column:
                  name: password
                  type: varchar(1024)
                  constraints:
                    nullable: 'false'
              - column:
                  name: email
                  type: varchar(128)
                  constraints:
                    unique: 'true'
                    nullable: 'false'

  - changeSet:
      id: create-role-authorities-table
      author: Nichbwasy
      changes:
        - createTable:
            schemaName: authorization
            tableName: role_authority
            columns:
              - column:
                  name: role_id
                  type: bigint
                  constraints:
                    nullable: 'false'
              - column:
                  name: authority_id
                  type: bigint
                  constraints:
                    nullable: 'false'

  - changeSet:
      id: create-user-role-table
      author: Nichbwasy
      changes:
        - createTable:
            schemaName: authorization
            tableName: user_role
            columns:
              - column:
                  name: user_id
                  type: bigint
                  constraints:
                    nullable: 'false'
              - column:
                  name: role_id
                  type: bigint
                  constraints:
                    nullable: 'false'

  - changeSet:
      id: create-user_refresh-token-table
      author: Nichbwasy
      changes:
        - createTable:
            schemaName: authorization
            tableName: user_refresh_token
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    unique: 'true'
                    nullable: 'false'
              - column:
                  name: user_id
                  type: bigint
                  constraints:
                    unique: 'true'
                    nullable: 'false'
              - column:
                  name: token
                  type: varchar(1024)
                  constraints:
                    nullable: 'false'

  - changeSet:
      id: add-tables-references
      author: Nichbwasy
      changes:
        - sql:
            dbms: 'postgresql'
            splitStatement: 'true'
            sql:
              ALTER TABLE "authorization".role_authority ADD FOREIGN KEY (authority_id) REFERENCES "authorization".authority (id) ON DELETE CASCADE;
              ALTER TABLE "authorization".role_authority ADD FOREIGN KEY (role_id) REFERENCES "authorization".role (id) ON DELETE CASCADE;
              ALTER TABLE "authorization".user_role ADD FOREIGN KEY (user_id) REFERENCES "authorization".user_data (id) ON DELETE CASCADE;
              ALTER TABLE "authorization".user_role ADD FOREIGN KEY (role_id) REFERENCES "authorization".role (id) ON DELETE CASCADE;
              ALTER TABLE "authorization".user_refresh_token ADD FOREIGN KEY (user_id) REFERENCES "authorization".user_data (id) ON DELETE CASCADE;

  - changeSet:
      id: add-base-roles
      author: Nichbwasy
      changes:
        - insert:
            schemaName: authorization
            tableName: role
            dbms: 'postgresql'
            columns:
              - column:
                  name: name
                  value: USER_ROLE
        - insert:
            schemaName: authorization
            tableName: role
            dbms: 'postgresql'
            columns:
              - column:
                  name: name
                  value: ADMIN_ROLE
